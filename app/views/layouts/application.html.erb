<!DOCTYPE html>
<html lang="<%= I18n.locale %>">
  <head>
    <title>ExerciseApp</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    
    <!-- Garante carregamento correto dos scripts -->
    <%= javascript_importmap_tags %>
    <script>
      console.log("Layout carregado - debug de JS");
    </script>
  </head>

  <body>
    <% if current_user %>
      <!-- Barra de navegaÃ§Ã£o -->
      <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container-fluid">
          <span class="navbar-brand">ExerciseApp</span>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <%= link_to t('menu.activities'), activities_path, class: "nav-link" %>
              </li>
              <% if current_user.teacher? %>
                <li class="nav-item">
                  <%= link_to t('menu.questions'), questions_path, class: "nav-link" %>
                </li>
              <% end %>
            </ul>
            
            <div class="dropdown me-3">
              <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <% case I18n.locale.to_s %>
                <% when 'pt-BR' %>
                  <i class="bi bi-globe"></i> ðŸ‡§ðŸ‡·
                <% when 'en' %>
                  <i class="bi bi-globe"></i> ðŸ‡ºðŸ‡¸
                <% when 'es' %>
                  <i class="bi bi-globe"></i> ðŸ‡ªðŸ‡¸
                <% when 'fr' %>
                  <i class="bi bi-globe"></i> ðŸ‡«ðŸ‡·
                <% else %>
                  <i class="bi bi-globe"></i> <%= I18n.locale %>
                <% end %>
              </button>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
                <% User::LANGUAGES.each do |language_code, language_name| %>
                  <li>
                    <%= form_tag update_language_path, method: :patch, data: { turbo: false }, class: "language-form" do %>
                      <%= hidden_field_tag :language, language_code %>
                      <button type="submit" class="dropdown-item">
                        <% case language_code %>
                        <% when 'pt-BR' %>
                          ðŸ‡§ðŸ‡· <%= language_name %>
                        <% when 'en' %>
                          ðŸ‡ºðŸ‡¸ <%= language_name %>
                        <% when 'es' %>
                          ðŸ‡ªðŸ‡¸ <%= language_name %>
                        <% when 'fr' %>
                          ðŸ‡«ðŸ‡· <%= language_name %>
                        <% else %>
                          <%= language_name %>
                        <% end %>
                      </button>
                    <% end %>
                  </li>
                <% end %>
              </ul>
            </div>
            
            <ul class="navbar-nav">
              <li class="nav-item">
                <%= link_to t('menu.logout'), destroy_user_session_path, data: { turbo_method: :delete }, class: "nav-link" %>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      
      <!-- ConteÃºdo principal com margem para a barra de navegaÃ§Ã£o -->
      <div class="container mt-5 pt-3">
        <% if flash.any? %>
          <div class="mt-3">
            <% flash.each do |key, message| %>
              <div class="alert alert-<%= key == 'notice' ? 'success' : 'danger' %> alert-dismissible fade show">
                <%= message %>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            <% end %>
          </div>
        <% end %>
        
        <%= yield %>
      </div>
    <% else %>
      <!-- Container sem a barra de navegaÃ§Ã£o para usuÃ¡rios nÃ£o logados -->
      <div class="container mt-4">
        <% if flash.any? %>
          <div class="mt-3">
            <% flash.each do |key, message| %>
              <div class="alert alert-<%= key == 'notice' ? 'success' : 'danger' %> alert-dismissible fade show">
                <%= message %>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            <% end %>
          </div>
        <% end %>
        
        <%= yield %>
      </div>
    <% end %>
  </body>
</html>
